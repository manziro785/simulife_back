import { Router, Request, Response } from "express";
import { DayStory } from "../models/DayStoty";
import { authMiddleware } from "../middleware/auth"; // ‚Üê –∏–º–ø–æ—Ä—Ç

const router = Router();

// –®–ê–ì 1: –ó–∞—â–∏—â—ë–Ω–Ω—ã–π —Ä–æ—É—Ç (—Ç–æ–ª—å–∫–æ —Å —Ç–æ–∫–µ–Ω–æ–º)
router.get("/", authMiddleware, async (req: Request, res: Response) => {
  try {
    const days = await DayStory.findAll();
    const mapped = days.map((d) => ({
      ...d.toJSON(),
      choices: d.choices ?? [],
      lesson: d.lesson ?? {},
    }));
    res.json(mapped);
  } catch (err) {
    console.error(err);
    res.status(500).json({ message: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–π" });
  }
});

// –®–ê–ì 2: –ü—É–±–ª–∏—á–Ω—ã–π —Ä–æ—É—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î (–ë–ï–ó —Ç–æ–∫–µ–Ω–∞)
// ‚ö†Ô∏è –£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ë–î!
router.post("/seed", async (_req: Request, res: Response) => {
  try {
    const daysData = [
      // ... –≤–µ—Å—å –≤–∞—à –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö
      {
        day: 1,
        title: "–ü–µ—Ä–≤–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞",
        description: "–°–µ–≥–æ–¥–Ω—è —Ç—ã –ø–æ–ª—É—á–∏–ª —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞—Ä–ø–ª–∞—Ç—É –∑–∞ –ø–æ–¥—Ä–∞–±–æ—Ç–∫—É.",
        context: "–£ —Ç–µ–±—è –≤ —Ä—É–∫–∞—Ö –∫–æ–Ω–≤–µ—Ä—Ç —Å –¥–µ–Ω—å–≥–∞–º–∏. –ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å?",
        choices: [
          {
            day: 1,
            title: "–ü–µ—Ä–≤–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞",
            description:
              "–°–µ–≥–æ–¥–Ω—è —Ç—ã –ø–æ–ª—É—á–∏–ª —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞—Ä–ø–ª–∞—Ç—É –∑–∞ –ø–æ–¥—Ä–∞–±–æ—Ç–∫—É.",
            context: "–£ —Ç–µ–±—è –≤ —Ä—É–∫–∞—Ö –∫–æ–Ω–≤–µ—Ä—Ç —Å –¥–µ–Ω—å–≥–∞–º–∏. –ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å?",
            choices: [
              {
                id: "invest",
                text: "–û—Ç–ª–æ–∂–∏—Ç—å 50% –Ω–∞ –±—É–¥—É—â–µ–µ",
                impact: { money: 150, energy: 0, mood: -10 },
              },
              {
                id: "spend",
                text: "–ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—Ç—Å—è",
                impact: { money: -100, energy: 0, mood: 30 },
              },
              {
                id: "balance",
                text: "–û—Ç–ª–æ–∂–∏—Ç—å 20% –∏ –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å",
                impact: { money: 50, energy: 0, mood: 10 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ –¥–µ–Ω—å–≥–∞—Ö",
              text: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞. –û—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –±—É–¥—É—â–µ–µ.",
              icon: "üí∞",
            },
          },
          {
            day: 2,
            title: "–≠–∫–∑–∞–º–µ–Ω –±–ª–∏–∑–∫–æ",
            description: "–ó–∞–≤—Ç—Ä–∞ –≤–∞–∂–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω, –Ω–æ –¥—Ä—É–∑—å—è –∑–æ–≤—É—Ç –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É.",
            context: "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞ –ø—Ä–µ–¥–µ–ª–µ. –ö–∞–∫ –ø–æ—Å—Ç—É–ø–∏—à—å?",
            choices: [
              {
                id: "study",
                text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è –∏ –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —ç–∫–∑–∞–º–µ–Ω—É",
                impact: { money: 0, energy: -30, mood: -20 },
              },
              {
                id: "party",
                text: "–ü–æ–π—Ç–∏ –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É –∏ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è",
                impact: { money: -50, energy: -40, mood: 40 },
              },
              {
                id: "quick-study",
                text: "–ë—ã—Å—Ç—Ä–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏ –ª–µ—á—å —Å–ø–∞—Ç—å",
                impact: { money: 0, energy: 20, mood: 10 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö",
              text: "–ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —É—á–µ–±–æ–π –∏ –æ—Ç–¥—ã—Ö–æ–º –≤–∞–∂–µ–Ω, –Ω–æ –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–º —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º —Ä–∞–¥–∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö —Ü–µ–ª–µ–π.",
              icon: "üìö",
            },
          },
          {
            day: 3,
            title: "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏",
            description: "–¢–µ–±–µ –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ –ø–æ–¥—Ä–∞–±–æ—Ç–∫—É –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö.",
            context: "–≠—Ç–æ —Ö–æ—Ä–æ—à–∏–µ –¥–µ–Ω—å–≥–∏, –Ω–æ —Ç—ã —É–∂–µ —É—Å—Ç–∞–ª –∑–∞ –Ω–µ–¥–µ–ª—é.",
            choices: [
              {
                id: "accept",
                text: "–ü—Ä–∏–Ω—è—Ç—å ‚Äî –¥–µ–Ω—å–≥–∏ –Ω—É–∂–Ω—ã",
                impact: { money: 200, energy: -50, mood: -15 },
              },
              {
                id: "decline",
                text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è –∏ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å",
                impact: { money: 0, energy: 40, mood: 25 },
              },
              {
                id: "half-day",
                text: "–î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ –ø–æ–ª–¥–Ω—è",
                impact: { money: 100, energy: -20, mood: 5 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ–± —ç–Ω–µ—Ä–≥–∏–∏",
              text: '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å. –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –æ—Ç–¥—ã—Ö–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤—ã–≥–æ—Ä–∞–Ω–∏—é. –£–º–µ–π –≥–æ–≤–æ—Ä–∏—Ç—å "–Ω–µ—Ç".',
              icon: "‚ö°",
            },
          },
          {
            day: 4,
            title: "–°–ø–æ–Ω—Ç–∞–Ω–Ω–∞—è –ø–æ–∫—É–ø–∫–∞",
            description: "–¢—ã —É–≤–∏–¥–µ–ª –≤ –º–∞–≥–∞–∑–∏–Ω–µ –≤–µ—â—å, –æ –∫–æ—Ç–æ—Ä–æ–π –¥–∞–≤–Ω–æ –º–µ—á—Ç–∞–ª.",
            context: "–¶–µ–Ω–∞ –≤—ã—Å–æ–∫–∞—è, –Ω–æ —ç—Ç–æ —Ç–æ, —á—Ç–æ —Ç—ã —Ö–æ—Ç–µ–ª. –ö—É–ø–∏—Ç—å?",
            choices: [
              {
                id: "buy",
                text: "–ö—É–ø–∏—Ç—å ‚Äî –∂–∏–∑–Ω—å –æ–¥–Ω–∞",
                impact: { money: -150, energy: 0, mood: 30 },
              },
              {
                id: "wait",
                text: "–ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ –Ω–∞–∫–æ–ø–∏—Ç—å",
                impact: { money: 0, energy: 0, mood: -10 },
              },
              {
                id: "research",
                text: "–ò–∑—É—á–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã",
                impact: { money: 0, energy: -10, mood: 5 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ–± –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç–∏",
              text: "–°–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ –ø—Ä–∏–Ω–æ—Å—è—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—É—é —Ä–∞–¥–æ—Å—Ç—å, –Ω–æ –º–æ–≥—É—Ç –ø–æ–¥–æ—Ä–≤–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —Ç–≤–æ–π —Å–æ—é–∑–Ω–∏–∫.",
              icon: "üõçÔ∏è",
            },
          },
          {
            day: 5,
            title: "–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å –¥—Ä—É–≥–æ–º",
            description: "–¢—ã –ø–æ—Å—Å–æ—Ä–∏–ª—Å—è —Å –¥—Ä—É–≥–æ–º –∏–∑-–∑–∞ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏—è.",
            context: "–≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–≤–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
            choices: [
              {
                id: "apologize",
                text: "–ò–∑–≤–∏–Ω–∏—Ç—å—Å—è –ø–µ—Ä–≤—ã–º",
                impact: { money: 0, energy: -10, mood: 20 },
              },
              {
                id: "ignore",
                text: "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é",
                impact: { money: 0, energy: 0, mood: -30 },
              },
              {
                id: "talk",
                text: "–°–ø–æ–∫–æ–π–Ω–æ –æ–±—Å—É–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É",
                impact: { money: 0, energy: -15, mood: 30 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö",
              text: "–ó–¥–æ—Ä–æ–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç—Ä–æ—è—Ç—Å—è –Ω–∞ –æ–±—â–µ–Ω–∏–∏. –£–º–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –∑—Ä–µ–ª–æ—Å—Ç–∏.",
              icon: "ü§ù",
            },
          },
          {
            day: 6,
            title: "–ù–æ–≤–æ–µ —É–≤–ª–µ—á–µ–Ω–∏–µ",
            description: "–¢—ã –Ω–∞—à–µ–ª –Ω–æ–≤–æ–µ —Ö–æ–±–±–∏, –∫–æ—Ç–æ—Ä–æ–µ —Ç–µ–±—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç.",
            context: "–ù–æ –æ–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–µ–Ω–µ–≥. –°—Ç–æ–∏—Ç –ª–∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å?",
            choices: [
              {
                id: "pursue",
                text: "–í–ª–æ–∂–∏—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é",
                impact: { money: -100, energy: -20, mood: 40 },
              },
              {
                id: "skip",
                text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è ‚Äî —Å–µ–π—á–∞—Å –Ω–µ –≤—Ä–µ–º—è",
                impact: { money: 0, energy: 0, mood: -20 },
              },
              {
                id: "moderate",
                text: "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ–Ω–µ–º–Ω–æ–≥—É",
                impact: { money: -30, energy: -10, mood: 20 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–∏",
              text: "–£–≤–ª–µ—á–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç –∂–∏–∑–Ω—å –Ω–∞—Å—ã—â–µ–Ω–Ω–æ–π. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å–µ–±—è –∏ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã ‚Äî —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Å—á–∞—Å—Ç—å–µ.",
              icon: "üé®",
            },
          },
          {
            day: 7,
            title: "–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏",
            description:
              "–ü–æ–¥–≤–æ–¥—è –∏—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏, —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.",
            context: "–¢—ã —Å—Ç–∞–ª –º—É–¥—Ä–µ–µ. –ß—Ç–æ —Ç—ã –≤—ã–±–µ—Ä–µ—à—å –Ω–∞ –±—É–¥—É—â–µ–µ?",
            choices: [
              {
                id: "reflect",
                text: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è",
                impact: { money: 0, energy: -10, mood: 25 },
              },
              {
                id: "celebrate",
                text: "–û—Ç–ø—Ä–∞–∑–¥–Ω–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è",
                impact: { money: -80, energy: -20, mood: 35 },
              },
              {
                id: "plan",
                text: "–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é",
                impact: { money: 0, energy: -15, mood: 20 },
              },
            ],
            lesson: {
              title: "–£—Ä–æ–∫ –æ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏",
              text: "–ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî —ç—Ç–æ —É—Ä–æ–∫. –£–º–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—Ç–∏ –∏ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ—à–∏–±–æ–∫.",
              icon: "üåü",
            },
          },
        ],
        lesson: {
          title: "–£—Ä–æ–∫ –æ –¥–µ–Ω—å–≥–∞—Ö",
          text: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞. –û—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ –±—É–¥—É—â–µ–µ.",
          icon: "üí∞",
        },
      },
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–Ω–∏ (—è —Å–æ–∫—Ä–∞—Ç–∏–ª –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
    ];

    const created = await Promise.all(
      daysData.map((day) =>
        DayStory.create({
          day: day.day,
          title: day.title,
          description: day.description,
          context: day.context,
          choices: day.choices,
          lesson: day.lesson,
        })
      )
    );
    res.status(201).json({ message: "–î–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã", count: created.length });
  } catch (err) {
    console.error(err);
    res.status(500).json({ message: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–Ω–µ–π" });
  }
});

export default router;
